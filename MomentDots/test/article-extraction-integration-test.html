<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡ç« æå–åŠŸèƒ½é›†æˆæµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      background: #f5f5f5;
    }

    .test-container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }

    .test-header {
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 1rem;
      margin-bottom: 2rem;
    }

    .test-header h1 {
      color: #1f2937;
      margin: 0;
      font-size: 1.875rem;
    }

    .test-section {
      margin-bottom: 2rem;
    }

    .test-section h2 {
      color: #374151;
      font-size: 1.25rem;
      margin-bottom: 1rem;
      border-left: 4px solid #3b82f6;
      padding-left: 1rem;
    }

    .input-group {
      margin-bottom: 1rem;
    }

    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #374151;
    }

    .input-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
    }

    .btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .btn:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: #6b7280;
    }

    .btn-secondary:hover {
      background: #4b5563;
    }

    .result-area {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      min-height: 200px;
    }

    .loading {
      text-align: center;
      color: #6b7280;
      font-style: italic;
    }

    .error {
      color: #dc2626;
      background: #fef2f2;
      border: 1px solid #fecaca;
      padding: 1rem;
      border-radius: 8px;
    }

    .success {
      color: #059669;
      background: #ecfdf5;
      border: 1px solid #a7f3d0;
      padding: 1rem;
      border-radius: 8px;
    }

    .article-preview {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 1rem;
    }

    .article-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
    }

    .article-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      color: #6b7280;
    }

    .content-preview {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 1rem;
      background: #fafafa;
      font-size: 0.875rem;
      line-height: 1.6;
    }

    .format-toggle {
      margin: 1rem 0;
    }

    .markdown-content {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .test-urls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .test-url-card {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .test-url-card:hover {
      background: #e5e7eb;
      border-color: #3b82f6;
    }

    .test-url-card h3 {
      margin: 0 0 0.5rem 0;
      font-size: 1rem;
      color: #1f2937;
    }

    .test-url-card p {
      margin: 0;
      font-size: 0.875rem;
      color: #6b7280;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>ğŸ” æ–‡ç« æå–åŠŸèƒ½é›†æˆæµ‹è¯•</h1>
      <p>æµ‹è¯•MomentDotsæ‰©å±•ç¨‹åºçš„æ–‡ç« å†…å®¹æå–åŠŸèƒ½</p>
    </div>

    <div class="test-section">
      <h2>ğŸ“ æ‰‹åŠ¨æµ‹è¯•</h2>
      <div class="input-group">
        <label for="test-url">è¾“å…¥æ–‡ç« é“¾æ¥ï¼š</label>
        <input type="url" id="test-url" placeholder="https://example.com/article">
      </div>
      <button class="btn" onclick="testArticleExtraction()">ğŸš€ å¼€å§‹æå–</button>
      <button class="btn btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
    </div>

    <div class="test-section">
      <h2>ğŸ¯ é¢„è®¾æµ‹è¯•é“¾æ¥</h2>
      <div class="test-urls">
        <div class="test-url-card" onclick="loadTestUrl('https://mp.weixin.qq.com/s/example')">
          <h3>ğŸ“± å¾®ä¿¡å…¬ä¼—å·</h3>
          <p>https://mp.weixin.qq.com/s/example</p>
        </div>
        <div class="test-url-card" onclick="loadTestUrl('https://www.zhihu.com/question/example')">
          <h3>ğŸ¤” çŸ¥ä¹é—®ç­”</h3>
          <p>https://www.zhihu.com/question/example</p>
        </div>
        <div class="test-url-card" onclick="loadTestUrl('https://okjike.com/originalPost/example')">
          <h3>ğŸ’­ å³åˆ»åŠ¨æ€</h3>
          <p>https://okjike.com/originalPost/example</p>
        </div>
        <div class="test-url-card" onclick="loadTestUrl('https://juejin.cn/post/example')">
          <h3>ğŸ’ æ˜é‡‘æ–‡ç« </h3>
          <p>https://juejin.cn/post/example</p>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>ğŸ“Š æå–ç»“æœ</h2>
      <div id="result-area" class="result-area">
        <p class="loading">ç‚¹å‡»"å¼€å§‹æå–"æŒ‰é’®æµ‹è¯•æ–‡ç« æå–åŠŸèƒ½</p>
      </div>
    </div>
  </div>

  <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
  <script src="../libs/readability/Readability.js"></script>
  <script src="../libs/readability/Readability-readerable.js"></script>
  <script src="../libs/readability/JSDOMParser.js"></script>
  <script src="../shared/services/ArticleExtractorService.js"></script>

  <script>
    let currentArticle = null;
    let currentFormat = 'html';

    function loadTestUrl(url) {
      document.getElementById('test-url').value = url;
    }

    function clearResults() {
      document.getElementById('result-area').innerHTML = '<p class="loading">ç‚¹å‡»"å¼€å§‹æå–"æŒ‰é’®æµ‹è¯•æ–‡ç« æå–åŠŸèƒ½</p>';
      currentArticle = null;
    }

    async function testArticleExtraction() {
      const urlInput = document.getElementById('test-url');
      const url = urlInput.value.trim();
      const resultArea = document.getElementById('result-area');

      if (!url) {
        resultArea.innerHTML = '<div class="error">è¯·è¾“å…¥æœ‰æ•ˆçš„æ–‡ç« é“¾æ¥</div>';
        return;
      }

      resultArea.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨æå–æ–‡ç« å†…å®¹ï¼Œè¯·ç¨å€™...</div>';

      try {
        // åˆ›å»ºArticleExtractorServiceå®ä¾‹
        const extractor = new ArticleExtractorService();
        
        // æ¨¡æ‹Ÿåœ¨æ–°æ ‡ç­¾é¡µä¸­æå–æ–‡ç« 
        const result = await simulateArticleExtraction(url);
        
        if (result.error) {
          throw new Error(result.error);
        }

        currentArticle = result;
        displayArticleResult(result);
        
      } catch (error) {
        console.error('æå–å¤±è´¥:', error);
        resultArea.innerHTML = `
          <div class="error">
            <h3>âŒ æå–å¤±è´¥</h3>
            <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>${error.message}</p>
            <p><strong>å»ºè®®ï¼š</strong></p>
            <ul>
              <li>æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®</li>
              <li>ç¡®ä¿ç½‘é¡µå¯ä»¥æ­£å¸¸è®¿é—®</li>
              <li>æŸäº›ç½‘ç«™å¯èƒ½æœ‰åçˆ¬è™«ä¿æŠ¤</li>
              <li>å°è¯•ä½¿ç”¨å…¶ä»–æµ‹è¯•é“¾æ¥</li>
            </ul>
          </div>
        `;
      }
    }

    async function simulateArticleExtraction(url) {
      // è¿™é‡Œæ¨¡æ‹Ÿæ–‡ç« æå–è¿‡ç¨‹
      // åœ¨å®é™…æ‰©å±•ç¨‹åºä¸­ï¼Œè¿™ä¼šé€šè¿‡chrome.scripting.executeScriptæ‰§è¡Œ
      
      console.log('æ¨¡æ‹Ÿæå–æ–‡ç« :', url);
      
      // æ¨¡æ‹Ÿè¿”å›çš„æ–‡ç« æ•°æ® - åŒ…å«å¾ˆé•¿çš„å†…å®¹æ¥æµ‹è¯•å¸ƒå±€
      const longContent = `
        <h2>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ç« æ ‡é¢˜ï¼Œç”¨æ¥æµ‹è¯•é•¿å†…å®¹å¯¹å¸ƒå±€çš„å½±å“</h2>
        <p>è¿™é‡Œæ˜¯æ–‡ç« çš„ä¸»è¦å†…å®¹ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™äº›å†…å®¹ä¼šé€šè¿‡Mozilla Readabilityç®—æ³•ä»ç½‘é¡µä¸­æå–ã€‚è¿™æ®µå†…å®¹ç‰¹æ„å†™å¾—å¾ˆé•¿ï¼Œç”¨æ¥æµ‹è¯•å½“æ–‡ç« å†…å®¹å¾ˆé•¿æ—¶ï¼Œé¡µé¢å¸ƒå±€æ˜¯å¦ä¼šè¢«æ’‘å¼€æˆ–å˜å½¢ã€‚</p>

        <h3>ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ€æœ¯ä»‹ç»</h3>
        <p>Mozilla Readabilityæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å†…å®¹æå–ç®—æ³•ï¼Œå®ƒèƒ½å¤Ÿæ™ºèƒ½åœ°è¯†åˆ«ç½‘é¡µä¸­çš„ä¸»è¦å†…å®¹ï¼Œè¿‡æ»¤æ‰å¹¿å‘Šã€å¯¼èˆªæ ã€ä¾§è¾¹æ ç­‰æ— å…³ä¿¡æ¯ã€‚è¿™ä¸ªç®—æ³•æœ€åˆæ˜¯ä¸ºFirefoxæµè§ˆå™¨çš„é˜…è¯»æ¨¡å¼å¼€å‘çš„ï¼Œç°åœ¨å·²ç»è¢«å¹¿æ³›åº”ç”¨äºå„ç§å†…å®¹æå–åœºæ™¯ã€‚</p>

        <img src="https://mmbiz.qpic.cn/mmbiz_png/OjgKEXmLURrj3QKXuGwib2IAnhU7TqqyRKPibTtWMgupN7vibxMZGYNGNGgUIW3uJ62icmsL7NzvDTe8ibG1JQzibz1g/640?wx_fmt=png&from=appmsg" alt="æŠ€æœ¯æ¶æ„å›¾" />

        <p>è¯¥ç®—æ³•çš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡åˆ†æHTMLç»“æ„ã€CSSæ ·å¼ã€æ–‡æœ¬å¯†åº¦ç­‰å¤šä¸ªç»´åº¦çš„ç‰¹å¾ï¼Œæ¥åˆ¤æ–­å“ªäº›å†…å®¹æ˜¯æ–‡ç« çš„ä¸»ä½“éƒ¨åˆ†ã€‚å®ƒä½¿ç”¨äº†æœºå™¨å­¦ä¹ å’Œå¯å‘å¼è§„åˆ™ç›¸ç»“åˆçš„æ–¹æ³•ï¼Œèƒ½å¤Ÿå¤„ç†å„ç§å¤æ‚çš„ç½‘é¡µç»“æ„ã€‚</p>

        <img src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E" alt="å ä½ç¬¦å›¾ç‰‡" data-original-src="https://mmbiz.qpic.cn/mmbiz_jpg/OjgKEXmLURrj3QKXuGwib2IAnhU7TqqyRKPibTtWMgupN7vibxMZGYNGNGgUIW3uJ62icmsL7NzvDTe8ibG1JQzibz1g/640?wx_fmt=jpeg&from=appmsg" />

        <h3>ç¬¬äºŒéƒ¨åˆ†ï¼šå®ç°ç»†èŠ‚</h3>
        <p>åœ¨æˆ‘ä»¬çš„æ‰©å±•ç¨‹åºä¸­ï¼Œæ–‡ç« æå–åŠŸèƒ½çš„å®ç°åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
        <ol>
          <li><strong>é¡µé¢åŠ è½½å’Œé¢„å¤„ç†</strong>ï¼šé¦–å…ˆåœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ç›®æ ‡URLï¼Œç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½</li>
          <li><strong>æ™ºèƒ½æ»šåŠ¨</strong>ï¼šè‡ªåŠ¨æ»šåŠ¨é¡µé¢ä»¥è§¦å‘æ‡’åŠ è½½å†…å®¹ï¼Œç¡®ä¿è·å–å®Œæ•´çš„æ–‡ç« å†…å®¹</li>
          <li><strong>å†…å®¹æå–</strong>ï¼šä½¿ç”¨Mozilla Readabilityç®—æ³•æå–ä¸»è¦å†…å®¹</li>
          <li><strong>å†…å®¹å¢å¼º</strong>ï¼šæå–å›¾ç‰‡ã€é“¾æ¥ã€è§†é¢‘ç­‰åª’ä½“ä¿¡æ¯ï¼Œç”Ÿæˆæ‘˜è¦å’Œå…ƒæ•°æ®</li>
          <li><strong>æ ¼å¼è½¬æ¢</strong>ï¼šæ”¯æŒHTMLå’ŒMarkdownä¸¤ç§æ ¼å¼çš„æ˜¾ç¤ºå’Œå¯¼å‡º</li>
        </ol>

        <h3>ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–</h3>
        <p>ä¸ºäº†æä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬åœ¨ç•Œé¢è®¾è®¡å’Œäº¤äº’æµç¨‹ä¸Šåšäº†å¤§é‡çš„ä¼˜åŒ–å·¥ä½œã€‚æ–‡ç« å†…å®¹çš„æ˜¾ç¤ºé‡‡ç”¨äº†å“åº”å¼è®¾è®¡ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒå±å¹•å°ºå¯¸çš„è®¾å¤‡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸°å¯Œçš„è§†è§‰åé¦ˆï¼ŒåŒ…æ‹¬åŠ è½½çŠ¶æ€ã€æˆåŠŸæç¤ºã€é”™è¯¯å¤„ç†ç­‰ã€‚</p>

        <p>ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å®ç°äº†HTMLå’ŒMarkdownæ ¼å¼çš„å®æ—¶åˆ‡æ¢åŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œé€‰æ‹©æŸ¥çœ‹åŸå§‹çš„HTMLæ ¼å¼ï¼Œæˆ–è€…è½¬æ¢ä¸ºæ›´é€‚åˆç¼–è¾‘çš„Markdownæ ¼å¼ã€‚è¿™ä¸ªåŠŸèƒ½å¯¹äºå†…å®¹åˆ›ä½œè€…æ¥è¯´éå¸¸å®ç”¨ã€‚</p>

        <blockquote>
          <p>è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—ï¼Œç”¨æ¥æµ‹è¯•å¼•ç”¨å†…å®¹çš„æ˜¾ç¤ºæ•ˆæœã€‚å¼•ç”¨å—é€šå¸¸ç”¨æ¥çªå‡ºæ˜¾ç¤ºé‡è¦çš„ä¿¡æ¯æˆ–è€…å¼•ç”¨å…¶ä»–æ¥æºçš„å†…å®¹ã€‚åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼Œå¼•ç”¨å—ä¼šæœ‰ç‰¹æ®Šçš„æ ·å¼å¤„ç†ï¼Œä½¿å…¶åœ¨è§†è§‰ä¸Šä¸æ™®é€šæ®µè½åŒºåˆ†å¼€æ¥ã€‚</p>
        </blockquote>

        <h3>ç¬¬å››éƒ¨åˆ†ï¼šæŠ€æœ¯æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ</h3>
        <p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€äº›æŠ€æœ¯æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†Chromeæ‰©å±•ç¨‹åºçš„å®‰å…¨é™åˆ¶æ–¹é¢ã€‚Chromeæ‰©å±•ç¨‹åºçš„Manifest V3è§„èŒƒå¯¹è„šæœ¬æ³¨å…¥æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œä¸èƒ½ç›´æ¥ä¼ é€’ç±»çš„é™æ€æ–¹æ³•ç»™executeScriptå‡½æ•°ã€‚</p>

        <p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é‡æ–°è®¾è®¡äº†ä»£ç æ¶æ„ï¼Œå°†æ‰€æœ‰éœ€è¦åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„é€»è¾‘å°è£…æˆç‹¬ç«‹çš„å‡½æ•°ï¼Œç¡®ä¿è¿™äº›å‡½æ•°æ˜¯å®Œå…¨è‡ªåŒ…å«çš„ï¼Œä¸ä¾èµ–å¤–éƒ¨çš„ç±»æˆ–æ¨¡å—ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å®‰å…¨è¦æ±‚ï¼Œåˆä¿è¯äº†åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚</p>

        <pre><code>// ç¤ºä¾‹ä»£ç ï¼šç‹¬ç«‹çš„æå–å‡½æ•°
function getExtractionFunction() {
  return async function() {
    // æ‰€æœ‰é€»è¾‘éƒ½åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨
    console.log('å¼€å§‹æå–æ–‡ç« å†…å®¹...');
    // ... æå–é€»è¾‘
  };
}</code></pre>

        <h3>ç¬¬äº”éƒ¨åˆ†ï¼šæµ‹è¯•å’ŒéªŒè¯</h3>
        <p>ä¸ºäº†ç¡®ä¿åŠŸèƒ½çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œæˆ‘ä»¬å»ºç«‹äº†å®Œæ•´çš„æµ‹è¯•ä½“ç³»ã€‚åŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚ç‰¹åˆ«æ˜¯ä½¿ç”¨Playwrightè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œèƒ½å¤Ÿæ¨¡æ‹ŸçœŸå®çš„ç”¨æˆ·æ“ä½œåœºæ™¯ï¼ŒéªŒè¯å„ç§åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>

        <p>æµ‹è¯•è¦†ç›–äº†å¤šä¸ªä¸»æµå¹³å°ï¼ŒåŒ…æ‹¬å¾®ä¿¡å…¬ä¼—å·ã€çŸ¥ä¹ã€å³åˆ»ã€æ˜é‡‘ç­‰ã€‚æ¯ä¸ªå¹³å°éƒ½æœ‰å…¶ç‰¹æ®Šçš„é¡µé¢ç»“æ„å’Œå†…å®¹ç»„ç»‡æ–¹å¼ï¼Œæˆ‘ä»¬çš„ç®—æ³•éƒ½èƒ½å¤Ÿå¾ˆå¥½åœ°é€‚åº”å’Œå¤„ç†ã€‚</p>

        <p>è¿™æ®µè¶…é•¿çš„å†…å®¹ä¸»è¦ç”¨æ¥æµ‹è¯•å½“æ–‡ç« å†…å®¹å¾ˆé•¿æ—¶ï¼Œé¡µé¢å¸ƒå±€æ˜¯å¦ä¼šä¿æŒç¨³å®šï¼Œä¸ä¼šå‡ºç°æ¨ªå‘æ‹‰ä¼¸æˆ–è€…å…¶ä»–å¸ƒå±€é—®é¢˜ã€‚é€šè¿‡è¿™ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯CSSæ ·å¼çš„ä¿®å¤æ˜¯å¦æœ‰æ•ˆã€‚</p>
      `;

      return {
        title: "è¶…é•¿æµ‹è¯•æ–‡ç« ï¼šéªŒè¯å¸ƒå±€ç¨³å®šæ€§å’Œå†…å®¹æ˜¾ç¤ºæ•ˆæœ",
        content: longContent,
        textContent: longContent.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim(),
        excerpt: "è¿™æ˜¯ä¸€ä¸ªåŒ…å«è¶…é•¿å†…å®¹çš„æµ‹è¯•æ–‡ç« ï¼Œä¸»è¦ç”¨æ¥éªŒè¯å½“æ–‡ç« å†…å®¹å¾ˆé•¿æ—¶ï¼Œé¡µé¢å¸ƒå±€æ˜¯å¦ä¼šä¿æŒç¨³å®šï¼Œä¸ä¼šå‡ºç°æ¨ªå‘æ‹‰ä¼¸æˆ–å…¶ä»–å¸ƒå±€é—®é¢˜ã€‚",
        byline: "æµ‹è¯•ä½œè€…",
        siteName: "æµ‹è¯•ç½‘ç«™",
        platform: "æµ‹è¯•å¹³å°",
        length: 2500,
        readingTime: 8,
        images: [
          { src: "https://via.placeholder.com/800x400", alt: "è¶…å®½æµ‹è¯•å›¾ç‰‡", caption: "è¿™æ˜¯ä¸€å¼ è¶…å®½çš„æµ‹è¯•å›¾ç‰‡ï¼Œç”¨æ¥æµ‹è¯•å›¾ç‰‡æ˜¯å¦ä¼šæ’‘å¼€å®¹å™¨" },
          { src: "https://via.placeholder.com/300x200", alt: "æ™®é€šæµ‹è¯•å›¾ç‰‡", caption: "è¿™æ˜¯ä¸€å¼ æ™®é€šçš„æµ‹è¯•å›¾ç‰‡" }
        ],
        links: [
          { url: "https://example.com/very-long-url-that-might-cause-layout-issues", text: "è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„é“¾æ¥æ–‡æœ¬ï¼Œç”¨æ¥æµ‹è¯•é•¿é“¾æ¥æ˜¯å¦ä¼šå½±å“å¸ƒå±€", isExternal: true },
          { url: "https://mozilla.org/readability", text: "Mozilla Readability", isExternal: true }
        ],
        videos: [
          { src: "https://example.com/video.mp4", type: "video", title: "æµ‹è¯•è§†é¢‘", platform: "Unknown" }
        ],
        url: url,
        timestamp: new Date().toISOString(),
        extractionMethod: 'mozilla-readability-enhanced'
      };
    }

    function displayArticleResult(article) {
      const resultArea = document.getElementById('result-area');
      
      resultArea.innerHTML = `
        <div class="success">
          <h3>âœ… æå–æˆåŠŸ</h3>
          <p>æˆåŠŸæå–æ–‡ç« å†…å®¹ï¼Œå…± ${article.length} ä¸ªå­—ç¬¦</p>
        </div>
        
        <div class="article-preview">
          <div class="article-title">${escapeHtml(article.title)}</div>
          
          <div class="article-meta">
            <span>ğŸ“± ${escapeHtml(article.platform)}</span>
            <span>âœï¸ ${escapeHtml(article.byline)}</span>
            <span>â±ï¸ çº¦ ${article.readingTime} åˆ†é’Ÿ</span>
            <span>ğŸ“ ${article.length} å­—ç¬¦</span>
            ${article.images?.length ? `<span>ğŸ–¼ï¸ ${article.images.length} å¼ å›¾ç‰‡</span>` : ''}
            ${article.links?.length ? `<span>ğŸ”— ${article.links.length} ä¸ªé“¾æ¥</span>` : ''}
          </div>

          ${article.excerpt ? `
            <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 1rem; margin: 1rem 0; border-radius: 0 8px 8px 0;">
              <h4 style="margin: 0 0 0.5rem 0; color: #0c4a6e;">æ‘˜è¦</h4>
              <p style="margin: 0; color: #075985;">${escapeHtml(article.excerpt)}</p>
            </div>
          ` : ''}

          <div class="format-toggle">
            <button class="btn btn-secondary" onclick="toggleFormat()">
              ğŸ”„ åˆ‡æ¢æ ¼å¼
            </button>
          </div>

          <div class="content-preview" id="content-preview">
            ${currentFormat === 'html' ? article.content : `<div class="markdown-content">${renderMarkdownToHtml(htmlToMarkdown(article.content))}</div>`}
          </div>
        </div>
      `;
    }

    function toggleFormat() {
      if (!currentArticle) return;
      
      currentFormat = currentFormat === 'html' ? 'markdown' : 'html';
      
      const contentPreview = document.getElementById('content-preview');
      if (contentPreview) {
        contentPreview.innerHTML = currentFormat === 'html' ?
          currentArticle.content :
          `<div class="markdown-content">${renderMarkdownToHtml(htmlToMarkdown(currentArticle.content))}</div>`;
      }
      
      // æ›´æ–°æŒ‰é’®æ–‡å­—
      const toggleBtn = document.querySelector('.format-toggle button');
      if (toggleBtn) {
        toggleBtn.textContent = `ğŸ”„ åˆ‡æ¢æ ¼å¼`;
      }
    }

    function htmlToMarkdown(html) {
      if (!html) return '';

      // æ”¹è¿›çš„HTMLåˆ°Markdownè½¬æ¢ï¼Œæ”¯æŒå›¾ç‰‡
      return html
        .replace(/<h([1-6])>(.*?)<\/h[1-6]>/g, (match, level, text) => {
          return '\n' + '#'.repeat(parseInt(level)) + ' ' + text + '\n\n';
        })
        .replace(/<p>(.*?)<\/p>/g, '\n$1\n\n')
        .replace(/<strong>(.*?)<\/strong>/g, '**$1**')
        .replace(/<em>(.*?)<\/em>/g, '*$1*')
        .replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/g, '[$2]($1)')
        // å›¾ç‰‡å¤„ç† - ä¼˜å…ˆä½¿ç”¨åŸå§‹å›¾ç‰‡URLï¼Œè¿‡æ»¤å ä½ç¬¦SVG
        .replace(/<img[^>]*>/g, (match) => {
          const srcMatch = match.match(/(?:data-original-src|data-src|src)="([^"]*)"/);
          const altMatch = match.match(/alt="([^"]*)"/);

          if (srcMatch) {
            const src = srcMatch[1];
            const alt = altMatch ? altMatch[1] : 'å›¾ç‰‡';

            // è¿‡æ»¤æ‰å ä½ç¬¦SVG
            if (!src.startsWith('data:image/svg+xml') && src.trim() !== '') {
              return `![${alt}](${src})`;
            }
          }
          return '';
        })
        .replace(/<br\s*\/?>/g, '\n')
        .replace(/<[^>]*>/g, '')
        .replace(/\n\s*\n\s*\n/g, '\n\n')
        .trim();
    }

    function renderMarkdownToHtml(markdown) {
      if (!markdown) return '';

      return markdown
        // æ ‡é¢˜
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')

        // å›¾ç‰‡ - å…³é”®ä¿®å¤ï¼šå°†Markdownå›¾ç‰‡è¯­æ³•è½¬æ¢ä¸ºHTML imgæ ‡ç­¾
        .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto; margin: 10px 0;" />')

        // é“¾æ¥
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')

        // ç²—ä½“å’Œæ–œä½“
        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
        .replace(/\*([^*]+)\*/g, '<em>$1</em>')

        // ä»£ç 
        .replace(/`([^`]+)`/g, '<code>$1</code>')

        // å¼•ç”¨
        .replace(/^> (.*)$/gm, '<blockquote>$1</blockquote>')

        // åˆ†å‰²çº¿
        .replace(/^---$/gm, '<hr>')

        // æ®µè½ - å°†åŒæ¢è¡Œè½¬æ¢ä¸ºæ®µè½
        .replace(/\n\n/g, '</p><p>')
        .replace(/^/, '<p>')
        .replace(/$/, '</p>')

        // æ¸…ç†ç©ºæ®µè½
        .replace(/<p><\/p>/g, '')
        .replace(/<p>\s*<\/p>/g, '');
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('æ–‡ç« æå–æµ‹è¯•é¡µé¢å·²åŠ è½½');
      console.log('ArticleExtractorServiceå¯ç”¨:', typeof ArticleExtractorService !== 'undefined');
      console.log('Readabilityå¯ç”¨:', typeof Readability !== 'undefined');
    });
  </script>
</body>
</html>
