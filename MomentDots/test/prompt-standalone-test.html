<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç¤ºè¯åŠ©æ‰‹ç‹¬ç«‹æµ‹è¯•</title>
    <link rel="stylesheet" href="../prompt/sidepanel.css">
    <link rel="stylesheet" href="../prompt/components/modal.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 400px;
            height: 600px;
            overflow: hidden;
        }
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10000;
            max-width: 200px;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo">
        <div>è°ƒè¯•ä¿¡æ¯:</div>
        <div id="debugStatus">åˆå§‹åŒ–ä¸­...</div>
    </div>

    <div class="prompt-container">
        <!-- é¡¶éƒ¨åˆ†ç±»å¯¼èˆªæ  -->
        <div class="prompt-category-nav">
            <div class="prompt-category-tabs" id="promptCategoryTabs">
                <!-- åˆ†ç±»æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button class="prompt-add-btn" id="promptAddBtn" title="æ·»åŠ æç¤ºè¯">+</button>
        </div>

        <!-- æç¤ºè¯å¡ç‰‡åˆ—è¡¨ -->
        <div class="prompt-list" id="promptList">
            <!-- æç¤ºè¯å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- åº•éƒ¨æ“ä½œåŒº -->
        <div class="prompt-bottom-actions">
            <div class="prompt-action-row">
                <button class="prompt-action-btn-large" id="promptExportBtn" title="å¯¼å‡ºæ•°æ®">
                    <span class="icon">ğŸ“¤</span>
                    å¯¼å‡º
                </button>
                <button class="prompt-action-btn-large" id="promptImportBtn" title="å¯¼å…¥æ•°æ®">
                    <span class="icon">ğŸ“¥</span>
                    å¯¼å…¥
                </button>
                <button class="prompt-settings-btn" id="promptSettingsBtn">
                    <span class="icon">âš™ï¸</span>
                </button>
            </div>
            <input type="file" id="promptImportFile" accept=".json" style="display: none;">
        </div>
    </div>

    <!-- æ¨¡æ‹ŸChromeæ‰©å±•API -->
    <script>
        // æ¨¡æ‹ŸChromeæ‰©å±•APIç”¨äºæµ‹è¯•
        if (typeof chrome === 'undefined') {
            window.chrome = {
                storage: {
                    local: {
                        data: {},
                        get: function(keys) {
                            return new Promise((resolve) => {
                                const result = {};
                                if (Array.isArray(keys)) {
                                    keys.forEach(key => {
                                        if (this.data[key]) {
                                            result[key] = this.data[key];
                                        }
                                    });
                                } else if (typeof keys === 'string') {
                                    if (this.data[keys]) {
                                        result[keys] = this.data[keys];
                                    }
                                }
                                console.log('æ¨¡æ‹Ÿå­˜å‚¨ GET:', keys, '=>', result);
                                resolve(result);
                            });
                        },
                        set: function(items) {
                            return new Promise((resolve) => {
                                Object.assign(this.data, items);
                                console.log('æ¨¡æ‹Ÿå­˜å‚¨ SET:', items);
                                resolve();
                            });
                        },
                        clear: function() {
                            return new Promise((resolve) => {
                                this.data = {};
                                console.log('æ¨¡æ‹Ÿå­˜å‚¨å·²æ¸…ç©º');
                                resolve();
                            });
                        }
                    }
                }
            };
            
            // åˆå§‹åŒ–ä¸€äº›æµ‹è¯•æ•°æ®
            chrome.storage.local.set({
                promptCategories: ['å…¨éƒ¨', 'åˆ›æ„è®¾è®¡', 'å†…å®¹å¯è§†åŒ–', 'å­¦ä¹ æå‡'],
                promptPrompts: [
                    {
                        id: 'prompt_1',
                        name: 'è®ºæ–‡å¤§å¸ˆæç¤ºè¯',
                        content: 'ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å­¦æœ¯å†™ä½œä¸“å®¶ï¼Œè¯·å¸®æˆ‘æ”¹å†™ä»¥ä¸‹å†…å®¹ï¼Œä½¿å…¶æ›´åŠ å­¦æœ¯åŒ–ã€ä¸¥è°¨ä¸”ç¬¦åˆè®ºæ–‡å†™ä½œè§„èŒƒã€‚',
                        category: 'å­¦ä¹ æå‡',
                        model: 'gemini-2.5-flash'
                    },
                    {
                        id: 'prompt_2',
                        name: 'å¾®ä¿¡è¡¨æƒ…åŒ…æç¤ºè¯',
                        content: 'è¯·å°†ä»¥ä¸‹æ–‡å­—è½¬æ¢ä¸ºé€‚åˆå¾®ä¿¡èŠå¤©çš„è¡¨æƒ…åŒ…æ–‡æ¡ˆï¼Œè¦æ±‚ç”ŸåŠ¨æœ‰è¶£ã€æœ—æœ—ä¸Šå£ã€‚',
                        category: 'åˆ›æ„è®¾è®¡',
                        model: 'gemini-2.5-flash'
                    }
                ],
                promptSettings: {
                    models: [
                        {
                            id: 'gemini-2.5-flash',
                            name: 'Gemini 2.5 Flash',
                            apiKey: '',
                            endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent'
                        }
                    ],
                    defaultModel: 'gemini-2.5-flash'
                }
            });
        }
        
        // è°ƒè¯•ä¿¡æ¯æ›´æ–°å‡½æ•°
        function updateDebugInfo(message) {
            const debugStatus = document.getElementById('debugStatus');
            if (debugStatus) {
                debugStatus.textContent = message;
            }
            console.log('è°ƒè¯•:', message);
        }
        
        updateDebugInfo('Chrome API æ¨¡æ‹Ÿå®Œæˆ');
    </script>

    <!-- åŠ è½½æç¤ºè¯åŠ©æ‰‹è„šæœ¬ -->
    <script src="../prompt/components/api.js"></script>
    <script src="../prompt/components/modal.js"></script>
    <script src="../prompt/sidepanel.js"></script>
    
    <script>
        // ç›‘å¬åº”ç”¨åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateDebugInfo('DOM åŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥åº”ç”¨æ˜¯å¦æˆåŠŸåˆå§‹åŒ–
            setTimeout(() => {
                if (window.promptApp) {
                    updateDebugInfo('åº”ç”¨åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    updateDebugInfo('åº”ç”¨åˆå§‹åŒ–å¤±è´¥');
                }
            }, 1000);
        });
        
        // ç›‘å¬é”™è¯¯
        window.addEventListener('error', (event) => {
            updateDebugInfo('é”™è¯¯: ' + event.message);
            console.error('é¡µé¢é”™è¯¯:', event);
        });
    </script>
</body>
</html>
