<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提示词助手独立测试</title>
    <link rel="stylesheet" href="../prompt/sidepanel.css">
    <link rel="stylesheet" href="../prompt/components/modal.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 400px;
            height: 600px;
            overflow: hidden;
        }
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10000;
            max-width: 200px;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo">
        <div>调试信息:</div>
        <div id="debugStatus">初始化中...</div>
    </div>

    <div class="prompt-container">
        <!-- 顶部分类导航栏 -->
        <div class="prompt-category-nav">
            <div class="prompt-category-tabs" id="promptCategoryTabs">
                <!-- 分类标签将通过JS动态生成 -->
            </div>
            <button class="prompt-add-btn" id="promptAddBtn" title="添加提示词">+</button>
        </div>

        <!-- 提示词卡片列表 -->
        <div class="prompt-list" id="promptList">
            <!-- 提示词卡片将通过JS动态生成 -->
        </div>

        <!-- 底部操作区 -->
        <div class="prompt-bottom-actions">
            <div class="prompt-action-row">
                <button class="prompt-action-btn-large" id="promptExportBtn" title="导出数据">
                    <span class="icon">📤</span>
                    导出
                </button>
                <button class="prompt-action-btn-large" id="promptImportBtn" title="导入数据">
                    <span class="icon">📥</span>
                    导入
                </button>
                <button class="prompt-settings-btn" id="promptSettingsBtn">
                    <span class="icon">⚙️</span>
                </button>
            </div>
            <input type="file" id="promptImportFile" accept=".json" style="display: none;">
        </div>
    </div>

    <!-- 模拟Chrome扩展API -->
    <script>
        // 模拟Chrome扩展API用于测试
        if (typeof chrome === 'undefined') {
            window.chrome = {
                storage: {
                    local: {
                        data: {},
                        get: function(keys) {
                            return new Promise((resolve) => {
                                const result = {};
                                if (Array.isArray(keys)) {
                                    keys.forEach(key => {
                                        if (this.data[key]) {
                                            result[key] = this.data[key];
                                        }
                                    });
                                } else if (typeof keys === 'string') {
                                    if (this.data[keys]) {
                                        result[keys] = this.data[keys];
                                    }
                                }
                                console.log('模拟存储 GET:', keys, '=>', result);
                                resolve(result);
                            });
                        },
                        set: function(items) {
                            return new Promise((resolve) => {
                                Object.assign(this.data, items);
                                console.log('模拟存储 SET:', items);
                                resolve();
                            });
                        },
                        clear: function() {
                            return new Promise((resolve) => {
                                this.data = {};
                                console.log('模拟存储已清空');
                                resolve();
                            });
                        }
                    }
                }
            };
            
            // 初始化一些测试数据
            chrome.storage.local.set({
                promptCategories: ['全部', '创意设计', '内容可视化', '学习提升'],
                promptPrompts: [
                    {
                        id: 'prompt_1',
                        name: '论文大师提示词',
                        content: '你是一位资深的学术写作专家，请帮我改写以下内容，使其更加学术化、严谨且符合论文写作规范。',
                        category: '学习提升',
                        model: 'gemini-2.5-flash'
                    },
                    {
                        id: 'prompt_2',
                        name: '微信表情包提示词',
                        content: '请将以下文字转换为适合微信聊天的表情包文案，要求生动有趣、朗朗上口。',
                        category: '创意设计',
                        model: 'gemini-2.5-flash'
                    }
                ],
                promptSettings: {
                    models: [
                        {
                            id: 'gemini-2.5-flash',
                            name: 'Gemini 2.5 Flash',
                            apiKey: '',
                            endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent'
                        }
                    ],
                    defaultModel: 'gemini-2.5-flash'
                }
            });
        }
        
        // 调试信息更新函数
        function updateDebugInfo(message) {
            const debugStatus = document.getElementById('debugStatus');
            if (debugStatus) {
                debugStatus.textContent = message;
            }
            console.log('调试:', message);
        }
        
        updateDebugInfo('Chrome API 模拟完成');
    </script>

    <!-- 加载提示词助手脚本 -->
    <script src="../prompt/components/api.js"></script>
    <script src="../prompt/components/modal.js"></script>
    <script src="../prompt/sidepanel.js"></script>
    
    <script>
        // 监听应用初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateDebugInfo('DOM 加载完成');
            
            // 检查应用是否成功初始化
            setTimeout(() => {
                if (window.promptApp) {
                    updateDebugInfo('应用初始化成功');
                } else {
                    updateDebugInfo('应用初始化失败');
                }
            }, 1000);
        });
        
        // 监听错误
        window.addEventListener('error', (event) => {
            updateDebugInfo('错误: ' + event.message);
            console.error('页面错误:', event);
        });
    </script>
</body>
</html>
