# MomentDots æ–°å¹³å°å¼€å‘æŒ‡å—

**ç‰ˆæœ¬ï¼š** v2.0  
**æ›´æ–°æ—¥æœŸï¼š** 2025-01-08  
**ä½œè€…ï¼š** MomentDots å¼€å‘å›¢é˜Ÿ

## ğŸ“‹ ç›®å½•

1. [å¼€å‘æµç¨‹æ¦‚è¿°](#å¼€å‘æµç¨‹æ¦‚è¿°)
2. [å¹³å°åˆ†ç±»å†³ç­–](#å¹³å°åˆ†ç±»å†³ç­–)
3. [Aç±»å¹³å°å¼€å‘æŒ‡å—](#aç±»å¹³å°å¼€å‘æŒ‡å—)
4. [Bç±»å¹³å°å¼€å‘æŒ‡å—](#bç±»å¹³å°å¼€å‘æŒ‡å—)
5. [è·¨æ ‡ç­¾é¡µå¹³å°å¼€å‘æŒ‡å—](#è·¨æ ‡ç­¾é¡µå¹³å°å¼€å‘æŒ‡å—)
6. [ä»£ç è§„èŒƒå’Œè´¨é‡æ ‡å‡†](#ä»£ç è§„èŒƒå’Œè´¨é‡æ ‡å‡†)
7. [æµ‹è¯•éªŒè¯æµç¨‹](#æµ‹è¯•éªŒè¯æµç¨‹)
8. [éƒ¨ç½²å’Œç»´æŠ¤](#éƒ¨ç½²å’Œç»´æŠ¤)

## ğŸš€ å¼€å‘æµç¨‹æ¦‚è¿°

### æ–°å¹³å°å¼€å‘çš„æ ‡å‡†æµç¨‹

```
éœ€æ±‚åˆ†æ â†’ å¹³å°åˆ†ç±» â†’ é€‰æ‹©æ¨¡æ¿ â†’ å®ç°é€‚é…å™¨ â†’ é…ç½®ç®¡ç† â†’ æµ‹è¯•éªŒè¯ â†’ ä»£ç å®¡æŸ¥ â†’ éƒ¨ç½²ä¸Šçº¿
```

### å¼€å‘å‰å‡†å¤‡

1. **ç¯å¢ƒå‡†å¤‡**
   - Chromeæµè§ˆå™¨å¼€å‘è€…ç‰ˆæœ¬
   - MomentDotsé¡¹ç›®æºç 
   - ç›®æ ‡å¹³å°çš„æµ‹è¯•è´¦å·

2. **æŠ€æœ¯è°ƒç ”**
   - åˆ†æç›®æ ‡å¹³å°çš„å‘å¸ƒæµç¨‹
   - è¯†åˆ«å…³é”®DOMå…ƒç´ å’Œé€‰æ‹©å™¨
   - äº†è§£å¹³å°çš„ç‰¹æ®ŠæŠ€æœ¯è¦æ±‚

3. **æ¶æ„åˆ†æ**
   - ç¡®å®šå¹³å°åˆ†ç±»ï¼ˆAç±»/Bç±»/è·¨æ ‡ç­¾é¡µï¼‰
   - é€‰æ‹©åˆé€‚çš„åŸºç±»å’Œæ¨¡æ¿
   - è§„åˆ’é…ç½®ç»“æ„

## ğŸ¯ å¹³å°åˆ†ç±»å†³ç­–

### å†³ç­–æµç¨‹å›¾

```
å¼€å§‹
  â†“
æ˜¯å¦éœ€è¦è·¨æ ‡ç­¾é¡µæ“ä½œï¼Ÿ
  â†“ æ˜¯
è·¨æ ‡ç­¾é¡µå¹³å°
  â†“ å¦
æ˜¯å¦éœ€è¦é¡µé¢è·³è½¬ï¼Ÿ
  â†“ æ˜¯
Bç±»å¹³å°ï¼ˆå¤šæ­¥éª¤æ“ä½œå‹ï¼‰
  â†“ å¦
Aç±»å¹³å°ï¼ˆç›´æ¥æ³¨å…¥å‹ï¼‰
```

### åˆ†ç±»åˆ¤æ–­æ ‡å‡†

#### Aç±»å¹³å°ï¼ˆç›´æ¥æ³¨å…¥å‹ï¼‰
**åˆ¤æ–­æ¡ä»¶ï¼š**
- âœ… åœ¨åŒä¸€ä¸ªé¡µé¢å®Œæˆæ‰€æœ‰æ“ä½œ
- âœ… é¡µé¢åŠ è½½åå³å¯è¿›è¡Œå†…å®¹æ³¨å…¥
- âœ… ä¸éœ€è¦ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®è¿›å…¥å‘å¸ƒæµç¨‹
- âœ… æ–‡ä»¶ä¸Šä¼ å’Œå†…å®¹æ³¨å…¥åœ¨åŒä¸€é¡µé¢

**å…¸å‹ç‰¹å¾ï¼š**
- é¡µé¢URLåŒ…å«"create"ã€"post"ã€"publish"ç­‰å…³é”®è¯
- é¡µé¢ç›´æ¥æ˜¾ç¤ºæ ‡é¢˜è¾“å…¥æ¡†ã€å†…å®¹ç¼–è¾‘å™¨ã€æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ
- æ“ä½œæµç¨‹ï¼šæ‰“å¼€é¡µé¢ â†’ ç›´æ¥æ³¨å…¥å†…å®¹

#### Bç±»å¹³å°ï¼ˆå¤šæ­¥éª¤æ“ä½œå‹ï¼‰
**åˆ¤æ–­æ¡ä»¶ï¼š**
- âœ… éœ€è¦å¤šä¸ªé¡µé¢å®Œæˆå‘å¸ƒæµç¨‹
- âœ… éœ€è¦å…ˆç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®è¿›å…¥å‘å¸ƒé¡µé¢
- âœ… é€šå¸¸å…ˆä¸Šä¼ æ–‡ä»¶ï¼Œå†è·³è½¬åˆ°å†…å®¹ç¼–è¾‘é¡µé¢
- âœ… æ¶‰åŠé¡µé¢çŠ¶æ€å˜åŒ–å’Œå¯¼èˆª

**å…¸å‹ç‰¹å¾ï¼š**
- é¦–é¡µæœ‰æ˜æ˜¾çš„"å‘å¸ƒ"ã€"åˆ›ä½œ"æŒ‰é’®
- ç‚¹å‡»åè·³è½¬åˆ°æ–‡ä»¶ä¸Šä¼ é¡µé¢
- ä¸Šä¼ å®Œæˆåè‡ªåŠ¨è·³è½¬åˆ°å†…å®¹ç¼–è¾‘é¡µé¢
- æ“ä½œæµç¨‹ï¼šé¦–é¡µ â†’ ç‚¹å‡»æŒ‰é’® â†’ ä¸Šä¼ æ–‡ä»¶ â†’ è·³è½¬ â†’ ç¼–è¾‘å†…å®¹

#### è·¨æ ‡ç­¾é¡µå¹³å°
**åˆ¤æ–­æ¡ä»¶ï¼š**
- âœ… ç‚¹å‡»å‘å¸ƒæŒ‰é’®ä¼šæ‰“å¼€æ–°æ ‡ç­¾é¡µ
- âœ… éœ€è¦åœ¨æ–°æ ‡ç­¾é¡µä¸­å®Œæˆå†…å®¹ç¼–è¾‘
- âœ… åŸæ ‡ç­¾é¡µå’Œæ–°æ ‡ç­¾é¡µéœ€è¦æ•°æ®ä¼ é€’
- âœ… æ— æ³•åœ¨å•ä¸ªContent Scriptä¸­å®Œæˆ

**å…¸å‹ç‰¹å¾ï¼š**
- ç‚¹å‡»å‘å¸ƒæŒ‰é’®ä½¿ç”¨ `target="_blank"`
- æ–°æ ‡ç­¾é¡µçš„URLä¸åŸé¡µé¢ä¸åŒ
- éœ€è¦è·¨æ ‡ç­¾é¡µä¼ é€’å‘å¸ƒæ•°æ®

## ğŸ¯ Aç±»å¹³å°å¼€å‘æŒ‡å—

### å¼€å‘æ¨¡æ¿

```javascript
/**
 * [å¹³å°åç§°]å¹³å°é€‚é…å™¨
 * åŸºäºç»Ÿä¸€çš„Aç±»å¹³å°æ¶æ„
 */

// 1. é…ç½®ç®¡ç†å™¨
class [PlatformName]ConfigManager extends PlatformConfigBase {
  constructor() {
    super('[platform-id]');
  }

  loadConfig() {
    const config = {
      delays: this.createDelayConfig({
        FAST_CHECK: 200,
        NORMAL_WAIT: 500,
        UPLOAD_WAIT: 1500,
        ELEMENT_WAIT: 3000
      }),

      limits: this.createLimitsConfig({
        maxContentLength: 2000,    // æ ¹æ®å¹³å°è°ƒæ•´
        maxTitleLength: 100,       // æ ¹æ®å¹³å°è°ƒæ•´
        maxMediaFiles: 9,          // æ ¹æ®å¹³å°è°ƒæ•´
        allowedImageTypes: ['image/jpeg', 'image/png', 'image/gif'],
        maxFileSize: 10 * 1024 * 1024  // 10MB
      }),

      selectors: {
        titleInput: 'input[placeholder*="æ ‡é¢˜"]',
        contentArea: '[contenteditable="true"]',
        fileInput: 'input[type="file"]',
        // æ·»åŠ å¹³å°ç‰¹å®šçš„é€‰æ‹©å™¨
      }
    };

    return this.loadPlatformConfig(config);
  }
}

// 2. DOMç›‘å¬å™¨
class [PlatformName]MutationObserver extends MutationObserverBase {
  constructor(adapter) {
    super('[platform-id]');
    this.adapter = adapter;
  }

  isTargetPage() {
    return window.location.href.includes('[platform-domain]');
  }

  checkElements() {
    if (!this.isTargetPage()) {
      return { ready: false, reason: 'ä¸æ˜¯ç›®æ ‡é¡µé¢' };
    }

    const titleInput = document.querySelector(this.adapter.config.selectors.titleInput);
    const fileInput = document.querySelector(this.adapter.config.selectors.fileInput);
    const contentArea = document.querySelector(this.adapter.config.selectors.contentArea);

    if (!titleInput || !fileInput || !contentArea) {
      return { ready: false, reason: 'å…³é”®å…ƒç´ æœªæ‰¾åˆ°' };
    }

    return { 
      ready: true, 
      elements: { titleInput, fileInput, contentArea }
    };
  }
}

// 3. ä¸»é€‚é…å™¨ç±»
class [PlatformName]PlatformAdapter extends PlatformAdapter {
  constructor() {
    super('[platform-id]');
    this.configManager = new [PlatformName]ConfigManager();
    this.config = this.configManager.loadConfig();
    this.mutationObserver = new [PlatformName]MutationObserver(this);
    
    this.log('[å¹³å°åç§°]é€‚é…å™¨åˆå§‹åŒ–å®Œæˆ');
  }

  // å¦‚æœéœ€è¦ç‰¹æ®Šçš„å…ƒç´ æŸ¥æ‰¾é€»è¾‘ï¼Œé‡å†™è¿™äº›æ–¹æ³•
  findTitleInput() {
    return document.querySelector(this.config.selectors.titleInput);
  }

  findFileInput() {
    return document.querySelector(this.config.selectors.fileInput);
  }

  findContentArea() {
    return document.querySelector(this.config.selectors.contentArea);
  }

  // å¦‚æœéœ€è¦ç‰¹æ®Šçš„æ¿€æ´»é€»è¾‘ï¼Œé‡å†™è¿™ä¸ªæ–¹æ³•
  async activateEditingArea() {
    return true; // å¤§å¤šæ•°Aç±»å¹³å°ä¸éœ€è¦æ¿€æ´»
  }

  // ç­‰å¾…é¡µé¢å…ƒç´ åŠ è½½
  async waitForElements() {
    this.log('ç­‰å¾…é¡µé¢å…ƒç´ åŠ è½½...');
    
    const maxAttempts = 30;
    for (let attempts = 0; attempts < maxAttempts; attempts++) {
      const checkResult = this.mutationObserver.checkElements();
      
      if (checkResult.ready) {
        this.log('âœ… æ‰€æœ‰å…³é”®å…ƒç´ å·²å°±ç»ª');
        return checkResult;
      }
      
      this.log(`â³ ç­‰å¾…å…ƒç´ åŠ è½½... (${attempts + 1}/${maxAttempts}) - ${checkResult.reason}`);
      await this.delay(this.config.delays.ELEMENT_WAIT / 10);
    }
    
    throw new Error('ç­‰å¾…å…ƒç´ è¶…æ—¶ï¼šå…³é”®å…ƒç´ æœªèƒ½åœ¨é¢„æœŸæ—¶é—´å†…åŠ è½½');
  }

  // ä¸»è¦çš„å‘å¸ƒæ–¹æ³•
  async publishContent(data) {
    try {
      this.log('ğŸš€ å¼€å§‹[å¹³å°åç§°]å†…å®¹å‘å¸ƒæµç¨‹...');

      // ç­‰å¾…é¡µé¢åŠ è½½
      await this.waitForElements();

      // ä½¿ç”¨åŸºç±»çš„ç»Ÿä¸€å‘å¸ƒæµç¨‹
      if (data.title) {
        await this.injectTitle(data.title);
      }

      if (data.fileIds?.length || data.files?.length) {
        await this.uploadFiles(data);
      }

      if (data.content) {
        await this.injectContent(data.content);
      }

      this.log('âœ… [å¹³å°åç§°]å†…å®¹å‘å¸ƒæµç¨‹å®Œæˆ');
      return { success: true, message: 'å†…å®¹å‘å¸ƒæˆåŠŸ' };

    } catch (error) {
      this.logError('âŒ [å¹³å°åç§°]å†…å®¹å‘å¸ƒå¤±è´¥:', error);
      return { success: false, error: error.message };
    }
  }
}

// 4. åˆå§‹åŒ–é€»è¾‘
async function initialize[PlatformName]Adapter() {
  try {
    const baseClassesReady = await BaseClassLoader.checkBaseClasses('[å¹³å°åç§°]');
    if (!baseClassesReady) {
      console.error('[å¹³å°åç§°]é€‚é…å™¨ï¼šåŸºç±»æœªå°±ç»ª');
      return;
    }

    const adapter = new [PlatformName]PlatformAdapter();
    
    window.MomentDots = window.MomentDots || {};
    window.MomentDots.[PlatformName]Adapter = adapter;
    window.[PlatformName]PlatformAdapter = [PlatformName]PlatformAdapter;

    adapter.mutationObserver.startObserving();

    console.log('âœ… [å¹³å°åç§°]é€‚é…å™¨åˆå§‹åŒ–æˆåŠŸ');
  } catch (error) {
    console.error('âŒ [å¹³å°åç§°]é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥:', error);
  }
}

// å¯åŠ¨é€‚é…å™¨
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initialize[PlatformName]Adapter);
} else {
  initialize[PlatformName]Adapter();
}
```

### Aç±»å¹³å°ç‰¹æ®Šæƒ…å†µå¤„ç†

#### Shadow DOMå¹³å°ï¼ˆå¦‚å¾®ä¿¡è§†é¢‘å·ï¼‰

```javascript
class ShadowDOMPlatformAdapter extends PlatformAdapter {
  // è·å–Shadow DOMæ ¹èŠ‚ç‚¹
  getShadowRoot() {
    const shadowHost = document.querySelector('[shadow-host-selector]');
    return shadowHost?.shadowRoot || null;
  }

  // åœ¨Shadow DOMä¸­æŸ¥æ‰¾å…ƒç´ 
  findElementInShadow(selector, fallbackSelectors = []) {
    const shadowRoot = this.getShadowRoot();
    if (!shadowRoot) return null;

    let element = shadowRoot.querySelector(selector);
    if (element) return element;

    for (const fallbackSelector of fallbackSelectors) {
      element = shadowRoot.querySelector(fallbackSelector);
      if (element) return element;
    }
    return null;
  }

  // é‡å†™å…ƒç´ æŸ¥æ‰¾æ–¹æ³•
  findTitleInput() {
    return this.findElementInShadow(this.config.selectors.titleInput);
  }

  findFileInput() {
    return this.findElementInShadow(this.config.selectors.fileInput);
  }

  findContentArea() {
    return this.findElementInShadow(this.config.selectors.contentArea);
  }
}
```

#### éœ€è¦æ¿€æ´»çš„å¹³å°

```javascript
class ActivationRequiredPlatformAdapter extends PlatformAdapter {
  async activateEditingArea() {
    // æŸ¥æ‰¾æ¿€æ´»è§¦å‘å…ƒç´ 
    const triggerElement = document.querySelector('[activation-trigger-selector]');

    if (triggerElement) {
      triggerElement.click();
      await this.delay(this.config.delays.NORMAL_WAIT);
      this.log('âœ… ç¼–è¾‘åŒºåŸŸå·²æ¿€æ´»');
    }

    return true;
  }
}
```

## ğŸ”„ Bç±»å¹³å°å¼€å‘æŒ‡å—

### å¼€å‘æ¨¡æ¿

```javascript
/**
 * [å¹³å°åç§°]å¹³å°é€‚é…å™¨ - Bç±»å¤šæ­¥éª¤æ“ä½œå‹
 */

class [PlatformName]PlatformAdapter extends PlatformAdapter {
  constructor() {
    super('[platform-id]');
    this.configManager = new [PlatformName]ConfigManager();
    this.config = this.configManager.loadConfig();
    this.currentStep = 'initial';

    this.log('[å¹³å°åç§°]é€‚é…å™¨åˆå§‹åŒ–å®Œæˆ');
  }

  async publishContent(data) {
    try {
      this.log('ğŸš€ å¼€å§‹[å¹³å°åç§°]å¤šæ­¥éª¤å‘å¸ƒæµç¨‹...');

      // æ­¥éª¤1ï¼šç‚¹å‡»å‘å¸ƒæŒ‰é’®
      await this.clickPublishButton();

      // æ­¥éª¤2ï¼šä¸Šä¼ æ–‡ä»¶
      if (data.fileIds?.length || data.files?.length) {
        await this.uploadFilesInFirstStep(data);
      }

      // æ­¥éª¤3ï¼šç­‰å¾…é¡µé¢è·³è½¬
      await this.waitForNavigation();

      // æ­¥éª¤4ï¼šåœ¨æ–°é¡µé¢æ³¨å…¥å†…å®¹
      if (data.title || data.content) {
        await this.injectContentInSecondStep(data);
      }

      this.log('âœ… [å¹³å°åç§°]å¤šæ­¥éª¤å‘å¸ƒæµç¨‹å®Œæˆ');
      return { success: true, message: 'å†…å®¹å‘å¸ƒæˆåŠŸ' };

    } catch (error) {
      this.logError('âŒ [å¹³å°åç§°]å†…å®¹å‘å¸ƒå¤±è´¥:', error);
      return { success: false, error: error.message };
    }
  }

  // æ­¥éª¤1ï¼šç‚¹å‡»å‘å¸ƒæŒ‰é’®
  async clickPublishButton() {
    this.log('æ­¥éª¤1ï¼šç‚¹å‡»å‘å¸ƒæŒ‰é’®');

    const publishButton = document.querySelector(this.config.selectors.publishButton);
    if (!publishButton) {
      throw new Error('å‘å¸ƒæŒ‰é’®æœªæ‰¾åˆ°');
    }

    publishButton.click();
    await this.delay(this.config.delays.NORMAL_WAIT);
    this.currentStep = 'fileUpload';
  }

  // æ­¥éª¤2ï¼šä¸Šä¼ æ–‡ä»¶
  async uploadFilesInFirstStep(data) {
    this.log('æ­¥éª¤2ï¼šä¸Šä¼ æ–‡ä»¶');

    // ç­‰å¾…æ–‡ä»¶ä¸Šä¼ é¡µé¢åŠ è½½
    await this.waitForFileUploadPage();

    // æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ 
    await this.uploadFiles(data);
    this.currentStep = 'waitingNavigation';
  }

  // æ­¥éª¤3ï¼šç­‰å¾…é¡µé¢è·³è½¬
  async waitForNavigation() {
    this.log('æ­¥éª¤3ï¼šç­‰å¾…é¡µé¢è·³è½¬');

    const maxAttempts = 30;
    for (let attempts = 0; attempts < maxAttempts; attempts++) {
      if (this.isContentEditPage()) {
        this.log('âœ… å·²è·³è½¬åˆ°å†…å®¹ç¼–è¾‘é¡µé¢');
        this.currentStep = 'contentEdit';
        return;
      }

      await this.delay(1000);
    }

    throw new Error('ç­‰å¾…é¡µé¢è·³è½¬è¶…æ—¶');
  }

  // æ­¥éª¤4ï¼šåœ¨æ–°é¡µé¢æ³¨å…¥å†…å®¹
  async injectContentInSecondStep(data) {
    this.log('æ­¥éª¤4ï¼šæ³¨å…¥å†…å®¹');

    // ç­‰å¾…ç¼–è¾‘é¡µé¢å…ƒç´ åŠ è½½
    await this.waitForEditPageElements();

    if (data.title) {
      await this.injectTitle(data.title);
    }

    if (data.content) {
      await this.injectContent(data.content);
    }

    this.currentStep = 'completed';
  }

  // è¾…åŠ©æ–¹æ³•
  async waitForFileUploadPage() {
    // ç­‰å¾…æ–‡ä»¶ä¸Šä¼ é¡µé¢çš„ç‰¹å®šå…ƒç´ 
    const maxAttempts = 20;
    for (let attempts = 0; attempts < maxAttempts; attempts++) {
      const fileInput = document.querySelector(this.config.selectors.fileInput);
      if (fileInput) {
        return;
      }
      await this.delay(500);
    }
    throw new Error('æ–‡ä»¶ä¸Šä¼ é¡µé¢åŠ è½½è¶…æ—¶');
  }

  isContentEditPage() {
    // æ£€æŸ¥æ˜¯å¦å·²è·³è½¬åˆ°å†…å®¹ç¼–è¾‘é¡µé¢
    return window.location.href.includes(this.config.editPagePattern) ||
           document.querySelector(this.config.selectors.titleInput);
  }

  async waitForEditPageElements() {
    // ç­‰å¾…ç¼–è¾‘é¡µé¢çš„å…³é”®å…ƒç´ 
    const maxAttempts = 20;
    for (let attempts = 0; attempts < maxAttempts; attempts++) {
      const titleInput = document.querySelector(this.config.selectors.titleInput);
      const contentArea = document.querySelector(this.config.selectors.contentArea);

      if (titleInput && contentArea) {
        return;
      }
      await this.delay(500);
    }
    throw new Error('ç¼–è¾‘é¡µé¢å…ƒç´ åŠ è½½è¶…æ—¶');
  }
}
```

## ğŸ”— è·¨æ ‡ç­¾é¡µå¹³å°å¼€å‘æŒ‡å—

### æ¶æ„è®¾è®¡

è·¨æ ‡ç­¾é¡µå¹³å°éœ€è¦ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œï¼š

1. **é¦–é¡µContent Script** - å¤„ç†å‘å¸ƒæŒ‰é’®ç‚¹å‡»
2. **Background Script** - åè°ƒæ ‡ç­¾é¡µå’Œæ•°æ®ä¼ é€’
3. **ç¼–è¾‘é¡µContent Script** - å¤„ç†å†…å®¹æ³¨å…¥

### å®ç°æ¨¡æ¿

#### é¦–é¡µContent Script

```javascript
// content-scripts/adapters/[platform]-home.js
class [PlatformName]HomeAdapter {
  constructor() {
    this.platformId = '[platform-id]';
    this.log('[å¹³å°åç§°]é¦–é¡µé€‚é…å™¨åˆå§‹åŒ–å®Œæˆ');
  }

  async handlePublishRequest(data) {
    try {
      this.log('ğŸš€ å¼€å§‹[å¹³å°åç§°]è·¨æ ‡ç­¾é¡µå‘å¸ƒæµç¨‹...');

      // å‘é€æ¶ˆæ¯ç»™Background Script
      const response = await this.sendMessageToBackground({
        action: 'openPublishTab',
        platform: this.platformId,
        data: data
      });

      if (response.success) {
        this.log('âœ… å‘å¸ƒæ ‡ç­¾é¡µå·²æ‰“å¼€');
        return { success: true, message: 'å‘å¸ƒæµç¨‹å·²å¯åŠ¨' };
      } else {
        throw new Error(response.error);
      }

    } catch (error) {
      this.logError('âŒ [å¹³å°åç§°]å‘å¸ƒæµç¨‹å¯åŠ¨å¤±è´¥:', error);
      return { success: false, error: error.message };
    }
  }

  sendMessageToBackground(message) {
    return new Promise((resolve) => {
      chrome.runtime.sendMessage(message, resolve);
    });
  }

  log(message) {
    console.log(`[${this.platformId}-home]`, message);
  }

  logError(message, error) {
    console.error(`[${this.platformId}-home]`, message, error);
  }
}

// åˆå§‹åŒ–é¦–é¡µé€‚é…å™¨
const homeAdapter = new [PlatformName]HomeAdapter();
window.MomentDots = window.MomentDots || {};
window.MomentDots.[PlatformName]HomeAdapter = homeAdapter;
```

#### Background Scriptå¤„ç†

```javascript
// background/background.js ä¸­æ·»åŠ 
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (message.action === 'openPublishTab' && message.platform === '[platform-id]') {
    handleCrossTabPublish(message, sender, sendResponse);
    return true; // ä¿æŒæ¶ˆæ¯é€šé“å¼€æ”¾
  }
});

async function handleCrossTabPublish(message, sender, sendResponse) {
  try {
    // åˆ›å»ºæ–°æ ‡ç­¾é¡µ
    const tab = await chrome.tabs.create({
      url: '[platform-edit-url]',
      active: true
    });

    // å­˜å‚¨å‘å¸ƒæ•°æ®
    await chrome.storage.local.set({
      [`publishData_${tab.id}`]: {
        ...message.data,
        sourceTabId: sender.tab.id,
        timestamp: Date.now()
      }
    });

    sendResponse({ success: true, tabId: tab.id });
  } catch (error) {
    sendResponse({ success: false, error: error.message });
  }
}
```

#### ç¼–è¾‘é¡µContent Script

```javascript
// content-scripts/adapters/[platform]-edit.js
class [PlatformName]EditAdapter extends PlatformAdapter {
  constructor() {
    super('[platform-id]');
    this.configManager = new [PlatformName]ConfigManager();
    this.config = this.configManager.loadConfig();

    this.log('[å¹³å°åç§°]ç¼–è¾‘é¡µé€‚é…å™¨åˆå§‹åŒ–å®Œæˆ');
    this.initializeCrossTabData();
  }

  async initializeCrossTabData() {
    try {
      // è·å–å½“å‰æ ‡ç­¾é¡µID
      const tabId = await this.getCurrentTabId();

      // ä»å­˜å‚¨ä¸­è·å–å‘å¸ƒæ•°æ®
      const result = await chrome.storage.local.get([`publishData_${tabId}`]);
      const publishData = result[`publishData_${tabId}`];

      if (publishData) {
        this.log('âœ… è·å–åˆ°è·¨æ ‡ç­¾é¡µå‘å¸ƒæ•°æ®');

        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œå‘å¸ƒ
        await this.waitForElements();
        await this.publishContent(publishData);

        // æ¸…ç†å­˜å‚¨æ•°æ®
        await chrome.storage.local.remove([`publishData_${tabId}`]);
      }
    } catch (error) {
      this.logError('è·¨æ ‡ç­¾é¡µæ•°æ®åˆå§‹åŒ–å¤±è´¥:', error);
    }
  }

  async getCurrentTabId() {
    return new Promise((resolve) => {
      chrome.runtime.sendMessage({ action: 'getCurrentTabId' }, resolve);
    });
  }

  async publishContent(data) {
    // ä½¿ç”¨æ ‡å‡†çš„Aç±»å¹³å°å‘å¸ƒæµç¨‹
    return await super.publishContent(data);
  }
}

// åˆå§‹åŒ–ç¼–è¾‘é¡µé€‚é…å™¨
const editAdapter = new [PlatformName]EditAdapter();
```

## ğŸ“ ä»£ç è§„èŒƒå’Œè´¨é‡æ ‡å‡†

### å‘½åè§„èŒƒ

```javascript
// ç±»åï¼šPascalCase
class WeixinChannelsPlatformAdapter extends PlatformAdapter {}

// æ–¹æ³•åï¼šcamelCase
async injectTitle(title) {}

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_FILE_SIZE = 10 * 1024 * 1024;

// å˜é‡ï¼šcamelCase
const titleInput = document.querySelector('input');

// æ–‡ä»¶åï¼škebab-case
// weixinchannels.js, xiaohongshu.js
```

### é”™è¯¯å¤„ç†è§„èŒƒ

```javascript
// 1. ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ ¼å¼
async publishContent(data) {
  try {
    // ä¸šåŠ¡é€»è¾‘
    return { success: true, message: 'å‘å¸ƒæˆåŠŸ' };
  } catch (error) {
    this.logError('å‘å¸ƒå¤±è´¥:', error);
    return { success: false, error: error.message };
  }
}

// 2. è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
if (!titleInput) {
  throw new Error('æ ‡é¢˜è¾“å…¥æ¡†æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥é€‰æ‹©å™¨é…ç½®');
}

// 3. é”™è¯¯åˆ†ç±»
class PlatformError extends Error {
  constructor(message, type = 'GENERAL') {
    super(message);
    this.type = type;
    this.name = 'PlatformError';
  }
}

// ä½¿ç”¨ç¤ºä¾‹
throw new PlatformError('å…ƒç´ æœªæ‰¾åˆ°', 'ELEMENT_NOT_FOUND');
```

### æ—¥å¿—è§„èŒƒ

```javascript
// 1. ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼
this.log('ğŸš€ å¼€å§‹å‘å¸ƒæµç¨‹...');
this.log('â³ ç­‰å¾…å…ƒç´ åŠ è½½...');
this.log('âœ… æ“ä½œæˆåŠŸ');
this.log('âš ï¸ è­¦å‘Šä¿¡æ¯');
this.logError('âŒ é”™è¯¯ä¿¡æ¯:', error);

// 2. æ—¥å¿—çº§åˆ«
class Logger {
  static DEBUG = 0;
  static INFO = 1;
  static WARN = 2;
  static ERROR = 3;

  log(level, message, ...args) {
    if (level >= this.currentLevel) {
      console.log(`[${this.platformId}]`, message, ...args);
    }
  }
}
```

### æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

```javascript
// 1. é¿å…é‡å¤çš„DOMæŸ¥è¯¢
class PlatformAdapter {
  constructor() {
    this._cachedElements = new Map();
  }

  findElement(selector) {
    if (!this._cachedElements.has(selector)) {
      this._cachedElements.set(selector, document.querySelector(selector));
    }
    return this._cachedElements.get(selector);
  }
}

// 2. æ‰¹é‡æ“ä½œ
// å¥½çš„åšæ³•
const events = ['input', 'change'];
events.forEach(eventType => {
  element.dispatchEvent(new Event(eventType, { bubbles: true }));
});

// é¿å…çš„åšæ³•
element.dispatchEvent(new Event('input', { bubbles: true }));
element.dispatchEvent(new Event('change', { bubbles: true }));

// 3. å¼‚æ­¥æ“ä½œä¼˜åŒ–
// å¹¶è¡Œæ‰§è¡Œä¸ç›¸å…³çš„æ“ä½œ
await Promise.all([
  this.injectTitle(data.title),
  this.uploadFiles(data.files)
]);
```

## ğŸ§ª æµ‹è¯•éªŒè¯æµç¨‹

### å•å…ƒæµ‹è¯•

```javascript
// tests/adapters/[platform].test.js
describe('[PlatformName]PlatformAdapter', () => {
  let adapter;

  beforeEach(() => {
    adapter = new [PlatformName]PlatformAdapter();
  });

  test('åº”è¯¥æ­£ç¡®åˆå§‹åŒ–é€‚é…å™¨', () => {
    expect(adapter.platformId).toBe('[platform-id]');
    expect(adapter.config).toBeDefined();
  });

  test('åº”è¯¥èƒ½æ‰¾åˆ°æ ‡é¢˜è¾“å…¥æ¡†', () => {
    // æ¨¡æ‹ŸDOMç¯å¢ƒ
    document.body.innerHTML = '<input placeholder="è¯·è¾“å…¥æ ‡é¢˜" />';

    const titleInput = adapter.findTitleInput();
    expect(titleInput).toBeTruthy();
  });

  test('åº”è¯¥èƒ½æ­£ç¡®æ³¨å…¥æ ‡é¢˜', async () => {
    document.body.innerHTML = '<input placeholder="è¯·è¾“å…¥æ ‡é¢˜" />';

    const result = await adapter.injectTitle('æµ‹è¯•æ ‡é¢˜');
    expect(result).toBe(true);

    const titleInput = adapter.findTitleInput();
    expect(titleInput.value).toBe('æµ‹è¯•æ ‡é¢˜');
  });
});
```

### é›†æˆæµ‹è¯•

```javascript
// tests/integration/[platform].integration.test.js
describe('[PlatformName] é›†æˆæµ‹è¯•', () => {
  test('å®Œæ•´å‘å¸ƒæµç¨‹æµ‹è¯•', async () => {
    const testData = {
      title: 'æµ‹è¯•æ ‡é¢˜',
      content: 'æµ‹è¯•å†…å®¹',
      files: [/* æµ‹è¯•æ–‡ä»¶ */]
    };

    const adapter = new [PlatformName]PlatformAdapter();
    const result = await adapter.publishContent(testData);

    expect(result.success).toBe(true);
  });
});
```

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

```markdown
## [å¹³å°åç§°] æ‰‹åŠ¨æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] é¡µé¢åŠ è½½æ£€æµ‹
- [ ] å…ƒç´ æŸ¥æ‰¾åŠŸèƒ½
- [ ] æ ‡é¢˜æ³¨å…¥åŠŸèƒ½
- [ ] å†…å®¹æ³¨å…¥åŠŸèƒ½
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½

### è¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] ç©ºæ ‡é¢˜å¤„ç†
- [ ] è¶…é•¿æ ‡é¢˜æˆªæ–­
- [ ] ç©ºå†…å®¹å¤„ç†
- [ ] è¶…é•¿å†…å®¹æˆªæ–­
- [ ] æ— æ–‡ä»¶ä¸Šä¼ 
- [ ] å¤§æ–‡ä»¶ä¸Šä¼ 
- [ ] ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹

### é”™è¯¯å¤„ç†æµ‹è¯•
- [ ] ç½‘ç»œé”™è¯¯å¤„ç†
- [ ] å…ƒç´ æœªæ‰¾åˆ°å¤„ç†
- [ ] æƒé™é”™è¯¯å¤„ç†
- [ ] è¶…æ—¶é”™è¯¯å¤„ç†

### æ€§èƒ½æµ‹è¯•
- [ ] é¡µé¢åŠ è½½æ—¶é—´
- [ ] å†…å®¹æ³¨å…¥é€Ÿåº¦
- [ ] æ–‡ä»¶ä¸Šä¼ é€Ÿåº¦
- [ ] å†…å­˜ä½¿ç”¨æƒ…å†µ
```

### è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·

```javascript
// ä½¿ç”¨Playwrightè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
const { test, expect } = require('@playwright/test');

test('[å¹³å°åç§°] è‡ªåŠ¨åŒ–å‘å¸ƒæµ‹è¯•', async ({ page }) => {
  // å¯¼èˆªåˆ°å¹³å°é¡µé¢
  await page.goto('[platform-url]');

  // ç­‰å¾…é¡µé¢åŠ è½½
  await page.waitForSelector('[title-input-selector]');

  // æ¨¡æ‹Ÿæ‰©å±•æ³¨å…¥
  await page.evaluate(() => {
    // æ³¨å…¥é€‚é…å™¨ä»£ç 
    // æ‰§è¡Œå‘å¸ƒæµç¨‹
  });

  // éªŒè¯ç»“æœ
  const titleInput = await page.locator('[title-input-selector]');
  await expect(titleInput).toHaveValue('æµ‹è¯•æ ‡é¢˜');
});
```

## ğŸš€ éƒ¨ç½²å’Œç»´æŠ¤

### éƒ¨ç½²æ¸…å•

```markdown
## æ–°å¹³å°éƒ¨ç½²æ¸…å•

### ä»£ç æ–‡ä»¶
- [ ] é€‚é…å™¨æ–‡ä»¶ï¼šcontent-scripts/adapters/[platform].js
- [ ] é…ç½®æ–‡ä»¶ï¼šshared/config/platforms.js æ›´æ–°
- [ ] manifest.json æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰

### æµ‹è¯•éªŒè¯
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### æ–‡æ¡£æ›´æ–°
- [ ] å¹³å°æ¶æ„æŒ‡å—æ›´æ–°
- [ ] APIæ–‡æ¡£æ›´æ–°
- [ ] ç”¨æˆ·æ‰‹å†Œæ›´æ–°
- [ ] æ›´æ–°æ—¥å¿—è®°å½•

### å‘å¸ƒæµç¨‹
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] ç‰ˆæœ¬å·æ›´æ–°
- [ ] æ‰“åŒ…æ„å»º
- [ ] æµ‹è¯•ç¯å¢ƒéªŒè¯
- [ ] ç”Ÿäº§ç¯å¢ƒå‘å¸ƒ
```

### ç»´æŠ¤æŒ‡å—

```javascript
// 1. ç›‘æ§å’Œæ—¥å¿—
class PlatformMonitor {
  static trackPublishSuccess(platform) {
    // è®°å½•æˆåŠŸå‘å¸ƒ
  }

  static trackPublishError(platform, error) {
    // è®°å½•å‘å¸ƒé”™è¯¯
  }

  static trackPerformance(platform, operation, duration) {
    // è®°å½•æ€§èƒ½æ•°æ®
  }
}

// 2. ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
class CompatibilityChecker {
  static checkPlatformChanges(platform) {
    // æ£€æŸ¥å¹³å°é¡µé¢æ˜¯å¦æœ‰å˜åŒ–
  }

  static validateSelectors(platform) {
    // éªŒè¯é€‰æ‹©å™¨æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
  }
}

// 3. è‡ªåŠ¨æ›´æ–°æœºåˆ¶
class AutoUpdater {
  static async updateSelectors(platform, newSelectors) {
    // è‡ªåŠ¨æ›´æ–°é€‰æ‹©å™¨é…ç½®
  }

  static async notifyMaintainers(platform, issue) {
    // é€šçŸ¥ç»´æŠ¤äººå‘˜
  }
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v2.0
**æœ€åæ›´æ–°ï¼š** 2025-01-08
**ç»´æŠ¤è€…ï¼š** MomentDots å¼€å‘å›¢é˜Ÿ

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–åœ¨é¡¹ç›®ä»“åº“ä¸­æäº¤Issueã€‚
